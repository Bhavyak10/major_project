
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ML experiments &#8212; Major Project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Links to Project:" href="linktoprojects.html" />
    <link rel="prev" title="Demo video" href="demovideo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Major Project - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Major Project - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="resume.html">Resume</a></li>
<li class="toctree-l1"><a class="reference internal" href="demovideo.html">Demo video</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">ML experiments</a></li>











<li class="toctree-l1"><a class="reference internal" href="linktoprojects.html">Links to Project:</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/bhavyak10/major_project" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bhavyak10/major_project/edit/gh-pages/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bhavyak10/major_project/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ML experiments</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">ML experiments</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-1-create-normalized-3nf-tables-customers-terminals-transactions">Task 1: Create normalized 3NF tables: Customers, Terminals, Transactions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-2-fetch-data-from-the-database-and-load-into-pandas-dataframe-using-join-statement">#Task 2: Fetch data from the database and load into Pandas DataFrame using join statement</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-3-stratified-train-test-split">Task-3 Stratified train-test split</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-4-eda-using-yprofile-and-correlation-matrix">Task-4 EDA using yprofile and correlation matrix</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-1-preprocessing-pipeline-with-logistic-regression-and-mlflow-logging">Experiment 1: Preprocessing Pipeline with Logistic Regression and MLflow Logging</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-2-preprocessing-pipeline-with-multiple-classifiers-and-mlflow-logging">Experiment 2: Preprocessing Pipeline with Multiple Classifiers and MLflow Logging</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-3-feature-engineering-and-attribute-combination">Experiment 3: Feature Engineering and Attribute Combination</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-4-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold">Experiment 4: Feature Selection using Correlation Threshold, Feature Importance, and Variance Threshold</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-5-pca-for-dimensionality-reduction">Experiment 5: PCA for Dimensionality Reduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-6-trainind-svm-model-with-preprocessing-evaluation-and-mlflow-logging">Experiment 6: Trainind SVM Model with Preprocessing, Evaluation, and MLflow Logging</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-7-training-a-naive-bayes-model-with-evaluation-visualization-and-mlflow-logging">Experiment 7: Training a Naive Bayes Model with Evaluation, Visualization, and MLflow Logging</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="ml-experiments">
<h1>ML experiments<a class="headerlink" href="#ml-experiments" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>mlflow
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>dagshub
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>ydata_profiling
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: mlflow in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (2.19.0)
Requirement already satisfied: mlflow-skinny==2.19.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (2.19.0)
Requirement already satisfied: Flask&lt;4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (3.1.0)
Requirement already satisfied: Jinja2&lt;4,&gt;=3.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (3.1.4)
Requirement already satisfied: alembic!=1.10.0,&lt;2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (1.14.0)
Requirement already satisfied: docker&lt;8,&gt;=4.0.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (7.1.0)
Requirement already satisfied: graphene&lt;4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (3.4.3)
Requirement already satisfied: markdown&lt;4,&gt;=3.3 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (3.7)
Requirement already satisfied: matplotlib&lt;4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (3.10.0)
Requirement already satisfied: numpy&lt;3 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (2.2.0)
Requirement already satisfied: pandas&lt;3 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (2.2.3)
Requirement already satisfied: pyarrow&lt;19,&gt;=4.0.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (18.1.0)
Requirement already satisfied: scikit-learn&lt;2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (1.6.0)
Requirement already satisfied: scipy&lt;2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (1.14.1)
Requirement already satisfied: sqlalchemy&lt;3,&gt;=1.4.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (2.0.36)
Requirement already satisfied: waitress&lt;4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow) (3.0.2)
Requirement already satisfied: cachetools&lt;6,&gt;=5.0.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (5.5.0)
Requirement already satisfied: click&lt;9,&gt;=7.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (8.1.7)
Requirement already satisfied: cloudpickle&lt;4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (3.1.0)
Requirement already satisfied: databricks-sdk&lt;1,&gt;=0.20.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.40.0)
Requirement already satisfied: gitpython&lt;4,&gt;=3.1.9 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (3.1.43)
Requirement already satisfied: importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (8.5.0)
Requirement already satisfied: opentelemetry-api&lt;3,&gt;=1.9.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: opentelemetry-sdk&lt;3,&gt;=1.9.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: packaging&lt;25 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (24.2)
Requirement already satisfied: protobuf&lt;6,&gt;=3.12.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (5.29.2)
Requirement already satisfied: pyyaml&lt;7,&gt;=5.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (6.0.2)
Requirement already satisfied: requests&lt;3,&gt;=2.17.3 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (2.32.3)
Requirement already satisfied: sqlparse&lt;1,&gt;=0.4.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.5.3)
Requirement already satisfied: Mako in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (1.3.8)
Requirement already satisfied: typing-extensions&gt;=4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (4.12.2)
Requirement already satisfied: pywin32&gt;=304 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from docker&lt;8,&gt;=4.0.0-&gt;mlflow) (308)
Requirement already satisfied: urllib3&gt;=1.26.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from docker&lt;8,&gt;=4.0.0-&gt;mlflow) (2.2.3)
Requirement already satisfied: Werkzeug&gt;=3.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from Flask&lt;4-&gt;mlflow) (3.1.3)
Requirement already satisfied: itsdangerous&gt;=2.2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from Flask&lt;4-&gt;mlflow) (2.2.0)
Requirement already satisfied: blinker&gt;=1.9 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from Flask&lt;4-&gt;mlflow) (1.9.0)
Requirement already satisfied: graphql-core&lt;3.3,&gt;=3.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from graphene&lt;4-&gt;mlflow) (3.2.5)
Requirement already satisfied: graphql-relay&lt;3.3,&gt;=3.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from graphene&lt;4-&gt;mlflow) (3.2.0)
Requirement already satisfied: python-dateutil&lt;3,&gt;=2.7.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from graphene&lt;4-&gt;mlflow) (2.9.0.post0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from Jinja2&lt;4,&gt;=3.0-&gt;mlflow) (3.0.2)
Requirement already satisfied: contourpy&gt;=1.0.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (1.3.1)
Requirement already satisfied: cycler&gt;=0.10 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (4.55.3)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (1.4.7)
Requirement already satisfied: pillow&gt;=8 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (11.0.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (3.2.0)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pandas&lt;3-&gt;mlflow) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pandas&lt;3-&gt;mlflow) (2024.2)
Requirement already satisfied: joblib&gt;=1.2.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from scikit-learn&lt;2-&gt;mlflow) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from scikit-learn&lt;2-&gt;mlflow) (3.5.0)
Requirement already satisfied: colorama in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from click&lt;9,&gt;=7.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.4.6)
Requirement already satisfied: google-auth~=2.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (2.37.0)
Requirement already satisfied: gitdb&lt;5,&gt;=4.0.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gitpython&lt;4,&gt;=3.1.9-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (4.0.11)
Requirement already satisfied: zipp&gt;=3.20 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (3.21.0)
Requirement already satisfied: deprecated&gt;=1.2.6 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.2.15)
Requirement already satisfied: opentelemetry-semantic-conventions==0.50b0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from opentelemetry-sdk&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.50b0)
Requirement already satisfied: six&gt;=1.5 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from python-dateutil&lt;3,&gt;=2.7.0-&gt;graphene&lt;4-&gt;mlflow) (1.17.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from requests&lt;3,&gt;=2.17.3-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (3.4.0)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from requests&lt;3,&gt;=2.17.3-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (3.10)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from requests&lt;3,&gt;=2.17.3-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (2024.12.14)
Requirement already satisfied: wrapt&lt;2,&gt;=1.10 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from deprecated&gt;=1.2.6-&gt;opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.17.0)
Requirement already satisfied: smmap&lt;6,&gt;=3.0.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gitdb&lt;5,&gt;=4.0.1-&gt;gitpython&lt;4,&gt;=3.1.9-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (5.0.1)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.4.1)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (4.9)
Requirement already satisfied: pyasn1&lt;0.7.0,&gt;=0.4.6 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.6.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: dagshub in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (0.4.0)
Requirement already satisfied: PyYAML&gt;=5 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (6.0.2)
Requirement already satisfied: appdirs&gt;=1.4.4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (1.4.4)
Requirement already satisfied: click&gt;=8.0.4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (8.1.7)
Requirement already satisfied: httpx&gt;=0.23.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (0.28.1)
Requirement already satisfied: GitPython&gt;=3.1.29 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (3.1.43)
Requirement already satisfied: rich&gt;=13.1.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (13.9.4)
Requirement already satisfied: dacite~=1.6.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (1.6.0)
Requirement already satisfied: tenacity&gt;=8.2.2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (9.0.0)
Requirement already satisfied: gql[requests] in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (3.5.0)
Requirement already satisfied: dataclasses-json in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (0.6.7)
Requirement already satisfied: pandas in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (2.2.3)
Requirement already satisfied: treelib&gt;=1.6.4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (1.7.0)
Requirement already satisfied: pathvalidate&gt;=3.0.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (3.2.1)
Requirement already satisfied: python-dateutil in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (2.9.0.post0)
Requirement already satisfied: boto3 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (1.35.86)
Requirement already satisfied: dagshub-annotation-converter&gt;=0.1.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub) (0.1.2)
Requirement already satisfied: colorama in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from click&gt;=8.0.4-&gt;dagshub) (0.4.6)
Requirement already satisfied: lxml in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (5.3.0)
Requirement already satisfied: pillow in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (11.0.0)
Requirement already satisfied: pydantic&gt;=2.0.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.10.4)
Requirement already satisfied: typing-extensions in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (4.12.2)
Requirement already satisfied: gitdb&lt;5,&gt;=4.0.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from GitPython&gt;=3.1.29-&gt;dagshub) (4.0.11)
Requirement already satisfied: anyio in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (4.7.0)
Requirement already satisfied: certifi in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (2024.12.14)
Requirement already satisfied: httpcore==1.* in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (1.0.7)
Requirement already satisfied: idna in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (3.10)
Requirement already satisfied: h11&lt;0.15,&gt;=0.13 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from httpcore==1.*-&gt;httpx&gt;=0.23.0-&gt;dagshub) (0.14.0)
Requirement already satisfied: markdown-it-py&gt;=2.2.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from rich&gt;=13.1.0-&gt;dagshub) (3.0.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from rich&gt;=13.1.0-&gt;dagshub) (2.18.0)
Requirement already satisfied: six in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from treelib&gt;=1.6.4-&gt;dagshub) (1.17.0)
Requirement already satisfied: botocore&lt;1.36.0,&gt;=1.35.86 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from boto3-&gt;dagshub) (1.35.86)
Requirement already satisfied: jmespath&lt;2.0.0,&gt;=0.7.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from boto3-&gt;dagshub) (1.0.1)
Requirement already satisfied: s3transfer&lt;0.11.0,&gt;=0.10.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from boto3-&gt;dagshub) (0.10.4)
Requirement already satisfied: marshmallow&lt;4.0.0,&gt;=3.18.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dataclasses-json-&gt;dagshub) (3.23.2)
Requirement already satisfied: typing-inspect&lt;1,&gt;=0.4.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from dataclasses-json-&gt;dagshub) (0.9.0)
Requirement already satisfied: graphql-core&lt;3.3,&gt;=3.2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gql[requests]-&gt;dagshub) (3.2.5)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.6 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gql[requests]-&gt;dagshub) (1.18.3)
Requirement already satisfied: backoff&lt;3.0,&gt;=1.11.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gql[requests]-&gt;dagshub) (2.2.1)
Requirement already satisfied: requests&lt;3,&gt;=2.26 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gql[requests]-&gt;dagshub) (2.32.3)
Requirement already satisfied: requests-toolbelt&lt;2,&gt;=1.0.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gql[requests]-&gt;dagshub) (1.0.0)
Requirement already satisfied: numpy&gt;=1.26.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pandas-&gt;dagshub) (2.2.0)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pandas-&gt;dagshub) (2024.2)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pandas-&gt;dagshub) (2024.2)
Requirement already satisfied: sniffio&gt;=1.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from anyio-&gt;httpx&gt;=0.23.0-&gt;dagshub) (1.3.1)
Requirement already satisfied: urllib3!=2.2.0,&lt;3,&gt;=1.25.4 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from botocore&lt;1.36.0,&gt;=1.35.86-&gt;boto3-&gt;dagshub) (2.2.3)
Requirement already satisfied: smmap&lt;6,&gt;=3.0.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from gitdb&lt;5,&gt;=4.0.1-&gt;GitPython&gt;=3.1.29-&gt;dagshub) (5.0.1)
Requirement already satisfied: mdurl~=0.1 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from markdown-it-py&gt;=2.2.0-&gt;rich&gt;=13.1.0-&gt;dagshub) (0.1.2)
Requirement already satisfied: packaging&gt;=17.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from marshmallow&lt;4.0.0,&gt;=3.18.0-&gt;dataclasses-json-&gt;dagshub) (24.2)
Requirement already satisfied: annotated-types&gt;=0.6.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (0.7.0)
Requirement already satisfied: pydantic-core==2.27.2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.27.2)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from requests&lt;3,&gt;=2.26-&gt;gql[requests]-&gt;dagshub) (3.4.0)
Requirement already satisfied: mypy-extensions&gt;=0.3.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from typing-inspect&lt;1,&gt;=0.4.0-&gt;dataclasses-json-&gt;dagshub) (1.0.0)
Requirement already satisfied: multidict&gt;=4.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from yarl&lt;2.0,&gt;=1.6-&gt;gql[requests]-&gt;dagshub) (6.1.0)
Requirement already satisfied: propcache&gt;=0.2.0 in c:\users\bhavya khilrani\appdata\local\programs\python\python313\lib\site-packages (from yarl&lt;2.0,&gt;=1.6-&gt;gql[requests]-&gt;dagshub) (0.2.1)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ERROR: Ignored the following versions that require a different python version: 4.0.0 Requires-Python &gt;=3.7, &lt;3.11; 4.1.0 Requires-Python &gt;=3.7, &lt;3.12; 4.1.1 Requires-Python &gt;=3.7, &lt;3.12; 4.1.2 Requires-Python &gt;=3.7, &lt;3.12; 4.10.0 Requires-Python &lt;3.13,&gt;=3.7; 4.11.0 Requires-Python &lt;3.13,&gt;=3.7; 4.12.0 Requires-Python &lt;3.13,&gt;=3.7; 4.12.1 Requires-Python &lt;3.13,&gt;=3.7; 4.2.0 Requires-Python &gt;=3.7, &lt;3.12; 4.3.0 Requires-Python &gt;=3.7, &lt;3.12; 4.3.1 Requires-Python &gt;=3.7, &lt;3.12; 4.3.2 Requires-Python &gt;=3.7, &lt;3.12; 4.4.0 Requires-Python &gt;=3.7, &lt;3.12; 4.5.0 Requires-Python &gt;=3.7, &lt;3.12; 4.5.1 Requires-Python &gt;=3.7, &lt;3.12; 4.6.0 Requires-Python &gt;=3.7, &lt;3.12; 4.6.1 Requires-Python &gt;=3.7, &lt;3.12; 4.6.2 Requires-Python &gt;=3.7, &lt;3.12; 4.6.3 Requires-Python &gt;=3.7, &lt;3.12; 4.6.4 Requires-Python &gt;=3.7, &lt;3.12; 4.6.5 Requires-Python &gt;=3.7, &lt;3.12; 4.7.0 Requires-Python &gt;=3.7, &lt;3.13; 4.8.3 Requires-Python &lt;3.13,&gt;=3.7; 4.9.0 Requires-Python &lt;3.13,&gt;=3.7
ERROR: Could not find a version that satisfies the requirement ydata_profiling (from versions: none)
ERROR: No matching distribution found for ydata_profiling
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">dagshub</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">ydata_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">16</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="ne">---&gt; </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;xgboost&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># intialise dagshub and setting repo</span>
<span class="n">dagshub</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">repo_owner</span><span class="o">=</span><span class="s2">&quot;Bhavyak10&quot;</span><span class="p">,</span>
    <span class="n">repo_name</span><span class="o">=</span><span class="s2">&quot;my-first-repo&quot;</span><span class="p">,</span>
    <span class="n">mlflow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;acb760347c850f69468022a046cecc8a4f2e0303&quot;</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/Bhavyak10/my-first-repo.mlflow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                                       <span style="font-weight: bold">❗❗❗ AUTHORIZATION REQUIRED ❗❗❗</span>                                        
</pre>
</div><script type="application/vnd.jupyter.widget-view+json">{"model_id": "c56e9a42069148c6bdee51e4a9a97f8f", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Open the following link in your browser to authorize the client:
https://dagshub.com/login/oauth/authorize?state=981e40bb-ae47-40b3-85a7-fcc22659c2fb&amp;client_id=32b60ba385aa7cecf24046d8195a71c07dd345d9657977863b52e7748e0f0f28&amp;middleman_request_id=332c3cc7bb8b1d60dcecbda4fd0b38f32b7be468015458479b8cb9fadf64293a
</pre></div>
</div>
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Accessing as bhavya004btmae18
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Initialized MLflow to track repo <span style="color: #008000; text-decoration-color: #008000">"Bhavyak10/my-first-repo"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Repository Bhavyak10/my-first-repo initialized!
</pre>
</div></div>
</div>
</section>
<section id="task-1-create-normalized-3nf-tables-customers-terminals-transactions">
<h1>Task 1: Create normalized 3NF tables: Customers, Terminals, Transactions<a class="headerlink" href="#task-1-create-normalized-3nf-tables-customers-terminals-transactions" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Create new database and create 3 tables with the schema</p></li>
<li><p>Load the CSV using csv module and iterate each row in csv</p></li>
<li><p>For each row, insert into all the relevant tables</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect to SQLite database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fraud_dataset_normalized.db&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Create tables</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS customers (</span>
<span class="s2">    customer_id INTEGER PRIMARY KEY,</span>
<span class="s2">    nb_tx_1day_window REAL,</span>
<span class="s2">    avg_amount_1day_window REAL,</span>
<span class="s2">    nb_tx_7day_window REAL,</span>
<span class="s2">    avg_amount_7day_window REAL,</span>
<span class="s2">    nb_tx_30day_window REAL,</span>
<span class="s2">    avg_amount_30day_window REAL</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS terminals (</span>
<span class="s2">    terminal_id INTEGER PRIMARY KEY,</span>
<span class="s2">    nb_tx_1day_window REAL,</span>
<span class="s2">    risk_1day_window REAL,</span>
<span class="s2">    nb_tx_7day_window REAL,</span>
<span class="s2">    risk_7day_window REAL,</span>
<span class="s2">    nb_tx_30day_window REAL,</span>
<span class="s2">    risk_30day_window REAL</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS transactions (</span>
<span class="s2">    transaction_id INTEGER PRIMARY KEY,</span>
<span class="s2">    tx_datetime TEXT NOT NULL,</span>
<span class="s2">    customer_id INTEGER NOT NULL,</span>
<span class="s2">    terminal_id INTEGER NOT NULL,</span>
<span class="s2">    tx_amount REAL,</span>
<span class="s2">    tx_time_seconds INTEGER,</span>
<span class="s2">    tx_time_days INTEGER,</span>
<span class="s2">    tx_fraud INTEGER,</span>
<span class="s2">    tx_fraud_scenario INTEGER,</span>
<span class="s2">    tx_during_weekend INTEGER,</span>
<span class="s2">    tx_during_night INTEGER,</span>
<span class="s2">    FOREIGN KEY (customer_id) REFERENCES customers (customer_id),</span>
<span class="s2">    FOREIGN KEY (terminal_id) REFERENCES terminals (terminal_id)</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Load the CSV file</span>
<span class="n">csv_file</span> <span class="o">=</span> <span class="s2">&quot;credit_card_fraud_data.csv&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="c1"># Insert into customers table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        INSERT OR IGNORE INTO customers (</span>
<span class="s2">            customer_id, nb_tx_1day_window, avg_amount_1day_window,</span>
<span class="s2">            nb_tx_7day_window, avg_amount_7day_window,</span>
<span class="s2">            nb_tx_30day_window, avg_amount_30day_window</span>
<span class="s2">        ) VALUES (?, ?, ?, ?, ?, ?, ?)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID_NB_TX_1DAY_WINDOW&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID_AVG_AMOUNT_1DAY_WINDOW&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID_NB_TX_7DAY_WINDOW&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID_AVG_AMOUNT_7DAY_WINDOW&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID_NB_TX_30DAY_WINDOW&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID_AVG_AMOUNT_30DAY_WINDOW&quot;</span><span class="p">]</span>
        <span class="p">))</span>

        <span class="c1"># Insert into terminals table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        INSERT OR IGNORE INTO terminals (</span>
<span class="s2">            terminal_id, nb_tx_1day_window, risk_1day_window,</span>
<span class="s2">            nb_tx_7day_window, risk_7day_window,</span>
<span class="s2">            nb_tx_30day_window, risk_30day_window</span>
<span class="s2">        ) VALUES (?, ?, ?, ?, ?, ?, ?)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID_NB_TX_1DAY_WINDOW&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID_RISK_1DAY_WINDOW&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID_NB_TX_7DAY_WINDOW&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID_RISK_7DAY_WINDOW&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID_NB_TX_30DAY_WINDOW&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID_RISK_30DAY_WINDOW&quot;</span><span class="p">]</span>
        <span class="p">))</span>

        <span class="c1"># Insert into transactions table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        INSERT INTO transactions (</span>
<span class="s2">            transaction_id, tx_datetime, customer_id, terminal_id, tx_amount,</span>
<span class="s2">            tx_time_seconds, tx_time_days, tx_fraud, tx_fraud_scenario,</span>
<span class="s2">            tx_during_weekend, tx_during_night</span>
<span class="s2">        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TRANSACTION_ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_DATETIME&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CUSTOMER_ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TERMINAL_ID&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_AMOUNT&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_TIME_SECONDS&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_TIME_DAYS&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_FRAUD&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_FRAUD_SCENARIO&quot;</span><span class="p">],</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_DURING_WEEKEND&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TX_DURING_NIGHT&quot;</span><span class="p">]</span>
        <span class="p">))</span>

<span class="c1"># Commit and close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="task-2-fetch-data-from-the-database-and-load-into-pandas-dataframe-using-join-statement">
<h1>#Task 2: Fetch data from the database and load into Pandas DataFrame using join statement<a class="headerlink" href="#task-2-fetch-data-from-the-database-and-load-into-pandas-dataframe-using-join-statement" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect to the SQLite database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fraud_dataset_normalized.db&quot;</span><span class="p">)</span>

<span class="c1"># SQL query to join all three tables</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">    t.transaction_id,</span>
<span class="s2">    t.tx_datetime,</span>
<span class="s2">    t.customer_id,</span>
<span class="s2">    t.terminal_id,</span>
<span class="s2">    t.tx_amount,</span>
<span class="s2">    t.tx_time_seconds,</span>
<span class="s2">    t.tx_time_days,</span>
<span class="s2">    t.tx_fraud,</span>
<span class="s2">    t.tx_fraud_scenario,</span>
<span class="s2">    t.tx_during_weekend,</span>
<span class="s2">    t.tx_during_night,</span>
<span class="s2">    c.nb_tx_1day_window AS customer_nb_tx_1day,</span>
<span class="s2">    c.avg_amount_1day_window AS customer_avg_amount_1day,</span>
<span class="s2">    c.nb_tx_7day_window AS customer_nb_tx_7day,</span>
<span class="s2">    c.avg_amount_7day_window AS customer_avg_amount_7day,</span>
<span class="s2">    c.nb_tx_30day_window AS customer_nb_tx_30day,</span>
<span class="s2">    c.avg_amount_30day_window AS customer_avg_amount_30day,</span>
<span class="s2">    tr.nb_tx_1day_window AS terminal_nb_tx_1day,</span>
<span class="s2">    tr.risk_1day_window AS terminal_risk_1day,</span>
<span class="s2">    tr.nb_tx_7day_window AS terminal_nb_tx_7day,</span>
<span class="s2">    tr.risk_7day_window AS terminal_risk_7day,</span>
<span class="s2">    tr.nb_tx_30day_window AS terminal_nb_tx_30day,</span>
<span class="s2">    tr.risk_30day_window AS terminal_risk_30day</span>
<span class="s2">FROM transactions t</span>
<span class="s2">JOIN customers c ON t.customer_id = c.customer_id</span>
<span class="s2">JOIN terminals tr ON t.terminal_id = tr.terminal_id</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Execute the query and load into a Pandas DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="c1"># Close the database connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Display the DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   transaction_id          tx_datetime  customer_id  terminal_id  tx_amount  \
0               0  2018-04-01 00:00:31          596         3156      57.16   
1               1  2018-04-01 00:02:10         4961         3412      81.51   
2               2  2018-04-01 00:07:56            2         1365     146.00   
3               3  2018-04-01 00:09:29         4128         8737      64.49   
4               4  2018-04-01 00:10:34          927         9906      50.99   

   tx_time_seconds  tx_time_days  tx_fraud  tx_fraud_scenario  \
0               31             0         0                  0   
1              130             0         0                  0   
2              476             0         0                  0   
3              569             0         0                  0   
4              634             0         0                  0   

   tx_during_weekend  ...  customer_nb_tx_7day  customer_avg_amount_7day  \
0                  1  ...                 33.0                 41.708788   
1                  1  ...                 26.0                 87.254615   
2                  1  ...                 16.0                 59.986875   
3                  1  ...                 27.0                 57.914074   
4                  1  ...                 20.0                 54.700000   

   customer_nb_tx_30day  customer_avg_amount_30day  terminal_nb_tx_1day  \
0                 122.0                  45.427131                  0.0   
1                 123.0                  91.142602                  1.0   
2                  60.0                  76.658833                  4.0   
3                 107.0                  58.195794                  1.0   
4                  91.0                  54.490549                  0.0   

   terminal_risk_1day  terminal_nb_tx_7day  terminal_risk_7day  \
0                 0.0                  4.0                 0.0   
1                 0.0                  8.0                 0.0   
2                 0.0                  8.0                 0.0   
3                 0.0                 13.0                 0.0   
4                 0.0                  4.0                 0.0   

   terminal_nb_tx_30day  terminal_risk_30day  
0                  23.0                  0.0  
1                  27.0                  0.0  
2                  33.0                  0.0  
3                  43.0                  0.0  
4                  19.0                  0.0  

[5 rows x 23 columns]
</pre></div>
</div>
</div>
</div>
</section>
<section id="task-3-stratified-train-test-split">
<h1>Task-3 Stratified train-test split<a class="headerlink" href="#task-3-stratified-train-test-split" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fraud_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tx_fraud&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fraud_counts</span><span class="p">)</span>

<span class="c1"># Calculate fraud percentages</span>
<span class="n">fraud_percentages</span> <span class="o">=</span> <span class="n">fraud_counts</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fraud_percentages</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tx_fraud
0    1739474
1      14681
Name: count, dtype: int64
tx_fraud
0    99.163073
1     0.836927
Name: count, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tx_fraud&quot;</span><span class="p">])</span>  <span class="c1"># Features</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tx_fraud&quot;</span><span class="p">]</span>                <span class="c1"># Target</span>

<span class="c1"># Perform train/test split with stratification</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
<span class="p">)</span>

<span class="c1"># Verify stratification</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training set fraud distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Testing set fraud distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training set fraud distribution:
tx_fraud
0    0.991631
1    0.008369
Name: proportion, dtype: float64

Testing set fraud distribution:
tx_fraud
0    0.991631
1    0.008369
Name: proportion, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="task-4-eda-using-yprofile-and-correlation-matrix">
<h1>Task-4 EDA using yprofile and correlation matrix<a class="headerlink" href="#task-4-eda-using-yprofile-and-correlation-matrix" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate the profile report</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Fraud Detection Dataset Profile&quot;</span><span class="p">,</span> <span class="n">explorative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the report to an HTML file</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;fraud_detection_profile.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "69d8f8237fc542b4906b1c811f708618", "version_major": 2, "version_minor": 0}</script><div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-8-be32910d9f9d&gt;</span> in <span class="ni">&lt;cell line: 5&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Save the report to an HTML file</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;fraud_detection_profile.html&quot;</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/profile_report.py</span> in <span class="ni">to_file</span><span class="nt">(self, output_file, silent)</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span>                 <span class="n">create_html_assets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">373</span> 
<span class="ne">--&gt; </span><span class="mi">374</span>             <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">375</span> 
<span class="g g-Whitespace">    </span><span class="mi">376</span>             <span class="k">if</span> <span class="n">output_file</span><span class="o">.</span><span class="n">suffix</span> <span class="o">!=</span> <span class="s2">&quot;.html&quot;</span><span class="p">:</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/profile_report.py</span> in <span class="ni">to_html</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">489</span> 
<span class="g g-Whitespace">    </span><span class="mi">490</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">491</span><span class="s2">         return self.html</span>
<span class="g g-Whitespace">    </span><span class="mi">492</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">493</span><span class="s2">     def to_json(self) -&gt; str:</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/profile_report.py</span> in <span class="ni">html</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span><span class="s2">     def html(self) -&gt; str:</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span><span class="s2">         if self._html is None:</span>
<span class="ne">--&gt; </span><span class="mi">287</span><span class="s2">             self._html = self._render_html()</span>
<span class="g g-Whitespace">    </span><span class="mi">288</span><span class="s2">         return self._html</span>
<span class="g g-Whitespace">    </span><span class="mi">289</span><span class="s2"> </span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/profile_report.py</span> in <span class="ni">_render_html</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span><span class="s2">         from ydata_profiling.report.presentation.flavours import HTMLReport</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">404</span><span class="s2">         report = self.report</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">406</span><span class="s2">         with tqdm(</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/profile_report.py</span> in <span class="ni">report</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">279</span><span class="s2">     def report(self) -&gt; Root:</span>
<span class="g g-Whitespace">    </span><span class="mi">280</span><span class="s2">         if self._report is None:</span>
<span class="ne">--&gt; </span><span class="mi">281</span><span class="s2">             self._report = get_report_structure(self.config, self.description_set)</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span><span class="s2">         return self._report</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span><span class="s2"> </span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/profile_report.py</span> in <span class="ni">description_set</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span><span class="s2">     def description_set(self) -&gt; BaseDescription:</span>
<span class="g g-Whitespace">    </span><span class="mi">262</span><span class="s2">         if self._description_set is None:</span>
<span class="ne">--&gt; </span><span class="mi">263</span><span class="s2">             self._description_set = describe_df(</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span><span class="s2">                 self.config,</span>
<span class="g g-Whitespace">    </span><span class="mi">265</span><span class="s2">                 self.df,</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/model/describe.py</span> in <span class="ni">describe</span><span class="nt">(config, df, summarizer, typeset, sample)</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span><span class="s2">             pbar.total += len(correlation_names)</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">106</span><span class="s2">             correlations = {</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span><span class="s2">                 correlation_name: progress(</span>
<span class="g g-Whitespace">    </span><span class="mi">108</span><span class="s2">                     calculate_correlation,</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/model/describe.py</span> in <span class="ni">&lt;dictcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">106</span><span class="s2">             correlations = {</span>
<span class="ne">--&gt; </span><span class="mi">107</span><span class="s2">                 correlation_name: progress(</span>
<span class="g g-Whitespace">    </span><span class="mi">108</span><span class="s2">                     calculate_correlation,</span>
<span class="g g-Whitespace">    </span><span class="mi">109</span><span class="s2">                     pbar,</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/utils/progress_bar.py</span> in <span class="ni">inner</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span><span class="s2">     def inner(*args, **kwargs) -&gt; Any:</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span><span class="s2">         bar.set_postfix_str(message)</span>
<span class="ne">---&gt; </span><span class="mi">11</span><span class="s2">         ret = fn(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span><span class="s2">         bar.update()</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="s2">         return ret</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/model/correlations.py</span> in <span class="ni">calculate_correlation</span><span class="nt">(config, df, correlation_name, summary)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span><span class="s2">     correlation = None</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span><span class="s2">     try:</span>
<span class="ne">--&gt; </span><span class="mi">102</span><span class="s2">         correlation = correlation_measures[correlation_name].compute(</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span><span class="s2">             config, df, summary</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span><span class="s2">         )</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/multimethod/__init__.py</span> in <span class="ni">__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">373</span><span class="s2">         func = self.dispatch(*args)</span>
<span class="g g-Whitespace">    </span><span class="mi">374</span><span class="s2">         try:</span>
<span class="ne">--&gt; </span><span class="mi">375</span><span class="s2">             return func(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span><span class="s2">         except TypeError as ex:</span>
<span class="g g-Whitespace">    </span><span class="mi">377</span><span class="s2">             raise DispatchError(f&quot;Function </span><span class="si">{func.__code__}</span><span class="s2">&quot;) from ex</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/model/pandas/correlations_pandas.py</span> in <span class="ni">pandas_auto_compute</span><span class="nt">(config, df, summary)</span>
<span class="g g-Whitespace">    </span><span class="mi">211</span><span class="s2">             )</span>
<span class="g g-Whitespace">    </span><span class="mi">212</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">213</span><span class="s2">         score = method(</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span><span class="s2">             f(col_1_name, method)[col_1_name], f(col_2_name, method)[col_2_name]</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span><span class="s2">         )</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/ydata_profiling/model/pandas/correlations_pandas.py</span> in <span class="ni">_pairwise_cramers</span><span class="nt">(col_1, col_2)</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span><span class="s2"> </span>
<span class="g g-Whitespace">     </span><span class="mi">86</span><span class="s2"> def _pairwise_cramers(col_1: pd.Series, col_2: pd.Series) -&gt; float:</span>
<span class="ne">---&gt; </span><span class="mi">87</span><span class="s2">     return _cramers_corrected_stat(pd.crosstab(col_1, col_2), correction=True)</span>
<span class="g g-Whitespace">     </span><span class="mi">88</span><span class="s2"> </span>
<span class="g g-Whitespace">     </span><span class="mi">89</span><span class="s2"> </span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/reshape/pivot.py</span> in <span class="ni">crosstab</span><span class="nt">(index, columns, values, rownames, colnames, aggfunc, margins, margins_name, dropna, normalize)</span>
<span class="g g-Whitespace">    </span><span class="mi">726</span><span class="s2">     # error: Argument 7 to &quot;pivot_table&quot; of &quot;DataFrame&quot; has incompatible type</span>
<span class="g g-Whitespace">    </span><span class="mi">727</span><span class="s2">     # &quot;**Dict[str, object]&quot;; expected &quot;Union[...]&quot;</span>
<span class="ne">--&gt; </span><span class="mi">728</span><span class="s2">     table = df.pivot_table(</span>
<span class="g g-Whitespace">    </span><span class="mi">729</span><span class="s2">         &quot;__dummy__&quot;,</span>
<span class="g g-Whitespace">    </span><span class="mi">730</span><span class="s2">         index=unique_rownames,</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/frame.py</span> in <span class="ni">pivot_table</span><span class="nt">(self, values, index, columns, aggfunc, fill_value, margins, dropna, margins_name, observed, sort)</span>
<span class="g g-Whitespace">   </span><span class="mi">9507</span><span class="s2">         from pandas.core.reshape.pivot import pivot_table</span>
<span class="g g-Whitespace">   </span><span class="mi">9508</span><span class="s2"> </span>
<span class="ne">-&gt; </span><span class="mi">9509</span><span class="s2">         return pivot_table(</span>
<span class="g g-Whitespace">   </span><span class="mi">9510</span><span class="s2">             self,</span>
<span class="g g-Whitespace">   </span><span class="mi">9511</span><span class="s2">             values=values,</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/reshape/pivot.py</span> in <span class="ni">pivot_table</span><span class="nt">(data, values, index, columns, aggfunc, fill_value, margins, dropna, margins_name, observed, sort)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span><span class="s2">         return table.__finalize__(data, method=&quot;pivot_table&quot;)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">102</span><span class="s2">     table = __internal_pivot_table(</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span><span class="s2">         data,</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span><span class="s2">         values,</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/reshape/pivot.py</span> in <span class="ni">__internal_pivot_table</span><span class="nt">(data, values, index, columns, aggfunc, fill_value, margins, dropna, margins_name, observed, sort)</span>
<span class="g g-Whitespace">    </span><span class="mi">181</span><span class="s2">             stacklevel=find_stack_level(),</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span><span class="s2">         )</span>
<span class="ne">--&gt; </span><span class="mi">183</span><span class="s2">     agged = grouped.agg(aggfunc)</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">185</span><span class="s2">     if dropna and isinstance(agged, ABCDataFrame) and len(agged.columns):</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/generic.py</span> in <span class="ni">aggregate</span><span class="nt">(self, func, engine, engine_kwargs, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1464</span><span class="s2">             if self._grouper.nkeys &gt; 1:</span>
<span class="g g-Whitespace">   </span><span class="mi">1465</span><span class="s2">                 # test_groupby_as_index_series_scalar gets here with &#39;not self.as_index&#39;</span>
<span class="ne">-&gt; </span><span class="mi">1466</span><span class="s2">                 return self._python_agg_general(func, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1467</span><span class="s2">             elif args or kwargs:</span>
<span class="g g-Whitespace">   </span><span class="mi">1468</span><span class="s2">                 # test_pass_args_kwargs gets here (with and without as_index)</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/generic.py</span> in <span class="ni">_python_agg_general</span><span class="nt">(self, func, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1515</span><span class="s2">         f = lambda x: func(x, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1516</span><span class="s2"> </span>
<span class="ne">-&gt; </span><span class="mi">1517</span><span class="s2">         if self.ngroups == 0:</span>
<span class="g g-Whitespace">   </span><span class="mi">1518</span><span class="s2">             # e.g. test_evaluate_with_empty_groups different path gets different</span>
<span class="g g-Whitespace">   </span><span class="mi">1519</span><span class="s2">             #  result dtype in empty case.</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/groupby.py</span> in <span class="ni">ngroups</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">854</span><span class="s2">     @property</span>
<span class="g g-Whitespace">    </span><span class="mi">855</span><span class="s2">     def ngroups(self) -&gt; int:</span>
<span class="ne">--&gt; </span><span class="mi">856</span><span class="s2">         return self._grouper.ngroups</span>
<span class="g g-Whitespace">    </span><span class="mi">857</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">858</span><span class="s2">     @final</span>

<span class="nn">properties.pyx</span> in <span class="ni">pandas._libs.properties.CachedProperty.__get__</span><span class="nt">()</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/ops.py</span> in <span class="ni">ngroups</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">772</span><span class="s2">     @cache_readonly</span>
<span class="g g-Whitespace">    </span><span class="mi">773</span><span class="s2">     def ngroups(self) -&gt; int:</span>
<span class="ne">--&gt; </span><span class="mi">774</span><span class="s2">         return len(self.result_index)</span>
<span class="g g-Whitespace">    </span><span class="mi">775</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">776</span><span class="s2">     @property</span>

<span class="nn">properties.pyx</span> in <span class="ni">pandas._libs.properties.CachedProperty.__get__</span><span class="nt">()</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/ops.py</span> in <span class="ni">result_index</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">785</span><span class="s2">             return self.groupings[0]._result_index.rename(self.names[0])</span>
<span class="g g-Whitespace">    </span><span class="mi">786</span><span class="s2"> </span>
<span class="ne">--&gt; </span><span class="mi">787</span><span class="s2">         codes = self.reconstructed_codes</span>
<span class="g g-Whitespace">    </span><span class="mi">788</span><span class="s2">         levels = [ping._result_index for ping in self.groupings]</span>
<span class="g g-Whitespace">    </span><span class="mi">789</span><span class="s2">         return MultiIndex(</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/ops.py</span> in <span class="ni">reconstructed_codes</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">776</span><span class="s2">     @property</span>
<span class="g g-Whitespace">    </span><span class="mi">777</span><span class="s2">     def reconstructed_codes(self) -&gt; list[npt.NDArray[np.intp]]:</span>
<span class="ne">--&gt; </span><span class="mi">778</span><span class="s2">         codes = self.codes</span>
<span class="g g-Whitespace">    </span><span class="mi">779</span><span class="s2">         ids, obs_ids, _ = self.group_info</span>
<span class="g g-Whitespace">    </span><span class="mi">780</span><span class="s2">         return decons_obs_group_ids(ids, obs_ids, self.shape, codes, xnull=True)</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/ops.py</span> in <span class="ni">codes</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">688</span><span class="s2">     @property</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span><span class="s2">     def codes(self) -&gt; list[npt.NDArray[np.signedinteger]]:</span>
<span class="ne">--&gt; </span><span class="mi">690</span><span class="s2">         return [ping.codes for ping in self.groupings]</span>
<span class="g g-Whitespace">    </span><span class="mi">691</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">692</span><span class="s2">     @property</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/ops.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">688</span><span class="s2">     @property</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span><span class="s2">     def codes(self) -&gt; list[npt.NDArray[np.signedinteger]]:</span>
<span class="ne">--&gt; </span><span class="mi">690</span><span class="s2">         return [ping.codes for ping in self.groupings]</span>
<span class="g g-Whitespace">    </span><span class="mi">691</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">692</span><span class="s2">     @property</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">codes</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">689</span><span class="s2">     @property</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span><span class="s2">     def codes(self) -&gt; npt.NDArray[np.signedinteger]:</span>
<span class="ne">--&gt; </span><span class="mi">691</span><span class="s2">         return self._codes_and_uniques[0]</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">693</span><span class="s2">     @cache_readonly</span>

<span class="nn">properties.pyx</span> in <span class="ni">pandas._libs.properties.CachedProperty.__get__</span><span class="nt">()</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/groupby/grouper.py</span> in <span class="ni">_codes_and_uniques</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">833</span><span class="s2">             # error: Incompatible types in assignment (expression has type &quot;Union[</span>
<span class="g g-Whitespace">    </span><span class="mi">834</span><span class="s2">             # ndarray[Any, Any], Index]&quot;, variable has type &quot;Categorical&quot;)</span>
<span class="ne">--&gt; </span><span class="mi">835</span><span class="s2">             codes, uniques = algorithms.factorize(  # type: ignore[assignment]</span>
<span class="g g-Whitespace">    </span><span class="mi">836</span><span class="s2">                 self.grouping_vector, sort=self._sort, use_na_sentinel=self._dropna</span>
<span class="g g-Whitespace">    </span><span class="mi">837</span><span class="s2">             )</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/algorithms.py</span> in <span class="ni">factorize</span><span class="nt">(values, sort, use_na_sentinel, size_hint)</span>
<span class="g g-Whitespace">    </span><span class="mi">800</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">801</span><span class="s2">     if sort and len(uniques) &gt; 0:</span>
<span class="ne">--&gt; </span><span class="mi">802</span><span class="s2">         uniques, codes = safe_sort(</span>
<span class="g g-Whitespace">    </span><span class="mi">803</span><span class="s2">             uniques,</span>
<span class="g g-Whitespace">    </span><span class="mi">804</span><span class="s2">             codes,</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/algorithms.py</span> in <span class="ni">safe_sort</span><span class="nt">(values, codes, use_na_sentinel, assume_unique, verify)</span>
<span class="g g-Whitespace">   </span><span class="mi">1561</span><span class="s2">         else:</span>
<span class="g g-Whitespace">   </span><span class="mi">1562</span><span class="s2">             mask = None</span>
<span class="ne">-&gt; </span><span class="mi">1563</span><span class="s2">         new_codes = take_nd(order2, codes, fill_value=-1)</span>
<span class="g g-Whitespace">   </span><span class="mi">1564</span><span class="s2">     else:</span>
<span class="g g-Whitespace">   </span><span class="mi">1565</span><span class="s2">         reverse_indexer = np.empty(len(sorter), dtype=int)</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/array_algos/take.py</span> in <span class="ni">take_nd</span><span class="nt">(arr, indexer, axis, fill_value, allow_fill)</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">116</span><span class="s2">     arr = np.asarray(arr)</span>
<span class="ne">--&gt; </span><span class="mi">117</span><span class="s2">     return _take_nd_ndarray(arr, indexer, axis, fill_value, allow_fill)</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">119</span><span class="s2"> </span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/pandas/core/array_algos/take.py</span> in <span class="ni">_take_nd_ndarray</span><span class="nt">(arr, indexer, axis, fill_value, allow_fill)</span>
<span class="g g-Whitespace">    </span><span class="mi">160</span><span class="s2">         arr.ndim, arr.dtype, out.dtype, axis=axis, mask_info=mask_info</span>
<span class="g g-Whitespace">    </span><span class="mi">161</span><span class="s2">     )</span>
<span class="ne">--&gt; </span><span class="mi">162</span><span class="s2">     func(arr, indexer, out, fill_value)</span>
<span class="g g-Whitespace">    </span><span class="mi">163</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">164</span><span class="s2">     if flip_order:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert TX_DATETIME to numeric</span>
<span class="k">if</span> <span class="s2">&quot;TX_DATETIME&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TX_DATETIME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;TX_DATETIME&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>  <span class="c1"># Ensure valid datetime</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TX_DATETIME_NUMERIC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;TX_DATETIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span> <span class="o">//</span> <span class="mf">1e9</span>    <span class="c1"># Convert to seconds since epoch</span>

<span class="c1"># Select only numeric columns</span>
<span class="n">numeric_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">])</span>

<span class="c1"># Compute correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">numeric_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Plot the heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix for Fraud Detection Dataset&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/71879c769df1876ec82ce6490757148a87ec1ec9c78908d4ed9669744fda40aa.png" src="_images/71879c769df1876ec82ce6490757148a87ec1ec9c78908d4ed9669744fda40aa.png" />
</div>
</div>
<p>Observations on features and distributions:</p>
<ol class="arabic simple">
<li><p>High Correlations: customer_nb_tx_1day, customer_nb_tx_7day, and customer_nb_tx_30day exhibit strong positive correlations with their respective averages (customer_avg_amount_<em>).
Similarly, terminal features (terminal_nb_tx_</em> and terminal_risk_*) show correlations within their groups.
tx_time_seconds and tx_time_days are perfectly correlated, as they represent the same feature in different units.</p></li>
<li><p>Capped Values:Features like customer_nb_tx_* and customer_avg_amount_* might have capped values, indicated by their consistent relationship with other variables.</p></li>
<li><p>Fraud Indicator:tx_fraud appears to have minimal correlation with numerical features, suggesting the fraud labels may depend on complex interactions rather than simple linear relationships.</p></li>
<li><p>Transaction Features:Features like tx_amount have low correlations with both customer- and terminal-related features, suggesting less direct influence.</p></li>
</ol>
<p>Data Cleanup Tasks:</p>
<ol class="arabic simple">
<li><p>Remove Redundant Features:Drop one of tx_time_seconds or tx_time_days as they are perfectly correlated and redundant.</p></li>
<li><p>Handle Multicollinearity:Consider removing highly correlated features like customer_avg_amount_* and terminal_risk_* in one time window to simplify the dataset and reduce redundancy.</p></li>
<li><p>Scale Features:Normalize or standardize features with a wide range, like tx_amount and transaction counts (<em><em>nb_tx</em></em>).</p></li>
<li><p>Impute or Drop Missing Values:
Verify missing data (if any) based on the report, and impute or drop rows/columns as necessary.</p></li>
<li><p>Check for Outliers:Inspect capped values in features like customer_nb_tx_* and customer_avg_amount_* for potential outliers.</p></li>
<li><p>Feature Engineering:Create interaction terms or derived features, such as ratios (e.g., tx_amount relative to average terminal or customer amounts).</p></li>
<li><p>Encoding Categorical Features:If categorical variables are present (not shown in the heatmap), ensure proper encoding before modeling.</p></li>
</ol>
</section>
<section id="experiment-1-preprocessing-pipeline-with-logistic-regression-and-mlflow-logging">
<h1>Experiment 1: Preprocessing Pipeline with Logistic Regression and MLflow Logging<a class="headerlink" href="#experiment-1-preprocessing-pipeline-with-logistic-regression-and-mlflow-logging" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># experiment 1</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment-1&quot;</span><span class="p">)</span>

<span class="c1"># Loading dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;credit_card_fraud_data.csv&quot;</span><span class="p">)</span>

<span class="c1"># Convert TX_DATETIME into useful features</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DAYOFWEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>  <span class="c1"># Day of the week</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>  <span class="c1"># Hour of the day</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_MONTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>  <span class="c1"># Month</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_YEAR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>  <span class="c1"># Year</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>  <span class="c1"># Day of the month</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_TIME_DIFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>  <span class="c1"># Time difference</span>

<span class="c1"># Features and target variable</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">,</span> <span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">]</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Preprocessing steps</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>  <span class="c1"># OneHotEncoding for categorical features</span>

<span class="c1"># Combine both transformers into a preprocessor</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">])</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
<span class="c1"># Create a logistic regression model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>

    <span class="c1"># Create a pipeline with preprocessing and model</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)])</span>

    <span class="c1"># Cross-validation (3/10 folds)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Perform cross-validation</span>
    <span class="n">cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cross-Validation Mean F1 Score: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cross-Validation Std F1 Score: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Fit the pipeline to the entire dataset and print confusion matrix</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Confusion Matrix:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Negatives: </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;False Positives: </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;False Negatives: </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Positives: </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Hyperparameter tuning</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;model__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;model__max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Print best parameters and best score</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Best Hyperparameters:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best F1 Score: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Best F1 Score&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cross-Validation Mean F1 Score: 0.9983
Cross-Validation Std F1 Score: 0.0003

Confusion Matrix:
True Negatives: 1739473
False Positives: 1
False Negatives: 24
True Positives: 14657

Best Hyperparameters:
{&#39;model__C&#39;: 0.1, &#39;model__max_iter&#39;: 100}
Best F1 Score: 1.0000
🏃 View run beautiful-dog-347 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/0/runs/707d0fede72043bb8be5514f753e5f42
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
</section>
<section id="experiment-2-preprocessing-pipeline-with-multiple-classifiers-and-mlflow-logging">
<h1>Experiment 2: Preprocessing Pipeline with Multiple Classifiers and MLflow Logging<a class="headerlink" href="#experiment-2-preprocessing-pipeline-with-multiple-classifiers-and-mlflow-logging" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># experiment-2</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment-2&quot;</span><span class="p">)</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Preprocessing steps</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>  <span class="c1"># Log Transformation</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># StandardScaler</span>
    <span class="p">(</span><span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">())</span>  <span class="c1"># MinMaxScaler</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>  <span class="c1"># OneHotEncoding for categorical features</span>

<span class="c1"># Combine both transformers into a preprocessor</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># Define models</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(),</span>
    <span class="s2">&quot;Ridge Classifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;Random Forest&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;mlogloss&quot;</span><span class="p">)</span>  <span class="c1"># XGBoost requires eval_metric for classification</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
        <span class="c1"># Log model hyperparameters</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

        <span class="c1"># Create a pipeline with preprocessing and model</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)])</span>

        <span class="c1"># Cross-validation (3/10 fold)</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

        <span class="c1"># Perform cross-validation</span>
        <span class="n">cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">)</span>

        <span class="c1"># Log metrics for cross-validation results</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_mean_f1_score&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_std_f1_score&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">))</span>

        <span class="c1"># Log confusion matrix for the last fold</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>

        <span class="c1"># Log the model</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/21 23:42:17 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run adorable-roo-657 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1/runs/554fe05b6d4c4c5b80b56ab6cc2325ad
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/21 23:42:40 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run abrasive-bee-821 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1/runs/55d23315582b40879ef9b173135179ea
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/21 23:59:40 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run loud-rook-612 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1/runs/07d06b4beb6e4ae2b4bb12ca9be417c5
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/model_selection/_validation.py:978: UserWarning: Scoring failed. The score on this train-test partition for these parameters will be set to nan. Details: 
Traceback (most recent call last):
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 140, in __call__
    score = scorer._score(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 380, in _score
    y_pred = method_caller(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 90, in _cached_call
    result, _ = _get_response_values(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/_response.py&quot;, line 242, in _get_response_values
    y_pred, pos_label = prediction_method(X), None
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 780, in predict
    with _raise_or_warn_if_not_fitted(self):
  File &quot;/usr/lib/python3.10/contextlib.py&quot;, line 142, in __exit__
    next(self.gen)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 60, in _raise_or_warn_if_not_fitted
    check_is_fitted(estimator)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1756, in check_is_fitted
    if not _is_fitted(estimator, attributes, all_or_any):
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1665, in _is_fitted
    return estimator.__sklearn_is_fitted__()
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 1310, in __sklearn_is_fitted__
    check_is_fitted(last_step)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1751, in check_is_fitted
    tags = get_tags(estimator)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py&quot;, line 405, in get_tags
    sklearn_tags_provider[klass] = klass.__sklearn_tags__(estimator)  # type: ignore[attr-defined]
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/base.py&quot;, line 540, in __sklearn_tags__
    tags = super().__sklearn_tags__()
AttributeError: &#39;super&#39; object has no attribute &#39;__sklearn_tags__&#39;

  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/model_selection/_validation.py:978: UserWarning: Scoring failed. The score on this train-test partition for these parameters will be set to nan. Details: 
Traceback (most recent call last):
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 140, in __call__
    score = scorer._score(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 380, in _score
    y_pred = method_caller(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 90, in _cached_call
    result, _ = _get_response_values(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/_response.py&quot;, line 242, in _get_response_values
    y_pred, pos_label = prediction_method(X), None
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 780, in predict
    with _raise_or_warn_if_not_fitted(self):
  File &quot;/usr/lib/python3.10/contextlib.py&quot;, line 142, in __exit__
    next(self.gen)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 60, in _raise_or_warn_if_not_fitted
    check_is_fitted(estimator)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1756, in check_is_fitted
    if not _is_fitted(estimator, attributes, all_or_any):
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1665, in _is_fitted
    return estimator.__sklearn_is_fitted__()
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 1310, in __sklearn_is_fitted__
    check_is_fitted(last_step)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1751, in check_is_fitted
    tags = get_tags(estimator)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py&quot;, line 405, in get_tags
    sklearn_tags_provider[klass] = klass.__sklearn_tags__(estimator)  # type: ignore[attr-defined]
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/base.py&quot;, line 540, in __sklearn_tags__
    tags = super().__sklearn_tags__()
AttributeError: &#39;super&#39; object has no attribute &#39;__sklearn_tags__&#39;

  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/model_selection/_validation.py:978: UserWarning: Scoring failed. The score on this train-test partition for these parameters will be set to nan. Details: 
Traceback (most recent call last):
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 140, in __call__
    score = scorer._score(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 380, in _score
    y_pred = method_caller(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_scorer.py&quot;, line 90, in _cached_call
    result, _ = _get_response_values(
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/_response.py&quot;, line 242, in _get_response_values
    y_pred, pos_label = prediction_method(X), None
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 780, in predict
    with _raise_or_warn_if_not_fitted(self):
  File &quot;/usr/lib/python3.10/contextlib.py&quot;, line 142, in __exit__
    next(self.gen)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 60, in _raise_or_warn_if_not_fitted
    check_is_fitted(estimator)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1756, in check_is_fitted
    if not _is_fitted(estimator, attributes, all_or_any):
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1665, in _is_fitted
    return estimator.__sklearn_is_fitted__()
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py&quot;, line 1310, in __sklearn_is_fitted__
    check_is_fitted(last_step)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py&quot;, line 1751, in check_is_fitted
    tags = get_tags(estimator)
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py&quot;, line 405, in get_tags
    sklearn_tags_provider[klass] = klass.__sklearn_tags__(estimator)  # type: ignore[attr-defined]
  File &quot;/usr/local/lib/python3.10/dist-packages/sklearn/base.py&quot;, line 540, in __sklearn_tags__
    tags = super().__sklearn_tags__()
AttributeError: &#39;super&#39; object has no attribute &#39;__sklearn_tags__&#39;

  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py:354: FutureWarning: The XGBClassifier or classes from which it inherits use `_get_tags` and `_more_tags`. Please define the `__sklearn_tags__` method, or inherit from `sklearn.base.BaseEstimator` and/or other appropriate mixins such as `sklearn.base.TransformerMixin`, `sklearn.base.ClassifierMixin`, `sklearn.base.RegressorMixin`, and `sklearn.base.OutlierMixin`. From scikit-learn 1.7, not defining `__sklearn_tags__` will raise an error.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run lyrical-slug-102 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1/runs/058638f1380b47508a2e1fb2885d16eb
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-11-30048e58123a&gt;</span> in <span class="ni">&lt;cell line: 33&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="c1"># Log confusion matrix for the last fold</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>         <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">54</span>         <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>         <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> 

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py</span> in <span class="ni">predict</span><span class="nt">(self, X, **params)</span>
<span class="g g-Whitespace">    </span><span class="mi">778</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">779</span><span class="s2">         # TODO(1.8): Remove the context manager and use check_is_fitted(self)</span>
<span class="ne">--&gt; </span><span class="mi">780</span><span class="s2">         with _raise_or_warn_if_not_fitted(self):</span>
<span class="g g-Whitespace">    </span><span class="mi">781</span><span class="s2">             Xt = X</span>
<span class="g g-Whitespace">    </span><span class="mi">782</span><span class="s2"> </span>

<span class="nn">/usr/lib/python3.10/contextlib.py</span> in <span class="ni">__exit__</span><span class="nt">(self, typ, value, traceback)</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span><span class="s2">         if typ is None:</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span><span class="s2">             try:</span>
<span class="ne">--&gt; </span><span class="mi">142</span><span class="s2">                 next(self.gen)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span><span class="s2">             except StopIteration:</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="s2">                 return False</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py</span> in <span class="ni">_raise_or_warn_if_not_fitted</span><span class="nt">(estimator)</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span><span class="s2">     # we only get here if the above didn&#39;t raise</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span><span class="s2">     try:</span>
<span class="ne">---&gt; </span><span class="mi">60</span><span class="s2">         check_is_fitted(estimator)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="s2">     except NotFittedError:</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span><span class="s2">         warnings.warn(</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py</span> in <span class="ni">check_is_fitted</span><span class="nt">(estimator, attributes, msg, all_or_any)</span>
<span class="g g-Whitespace">   </span><span class="mi">1754</span><span class="s2">         return</span>
<span class="g g-Whitespace">   </span><span class="mi">1755</span><span class="s2"> </span>
<span class="ne">-&gt; </span><span class="mi">1756</span><span class="s2">     if not _is_fitted(estimator, attributes, all_or_any):</span>
<span class="g g-Whitespace">   </span><span class="mi">1757</span><span class="s2">         raise NotFittedError(msg % {&quot;name&quot;: type(estimator).__name__})</span>
<span class="g g-Whitespace">   </span><span class="mi">1758</span><span class="s2"> </span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py</span> in <span class="ni">_is_fitted</span><span class="nt">(estimator, attributes, all_or_any)</span>
<span class="g g-Whitespace">   </span><span class="mi">1663</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1664</span><span class="s2">     if hasattr(estimator, &quot;__sklearn_is_fitted__&quot;):</span>
<span class="ne">-&gt; </span><span class="mi">1665</span><span class="s2">         return estimator.__sklearn_is_fitted__()</span>
<span class="g g-Whitespace">   </span><span class="mi">1666</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1667</span><span class="s2">     fitted_attrs = [</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/pipeline.py</span> in <span class="ni">__sklearn_is_fitted__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1308</span><span class="s2">             # means the previous steps should also be fit. This is faster than</span>
<span class="g g-Whitespace">   </span><span class="mi">1309</span><span class="s2">             # checking if every step of the pipeline is fit.</span>
<span class="ne">-&gt; </span><span class="mi">1310</span><span class="s2">             check_is_fitted(last_step)</span>
<span class="g g-Whitespace">   </span><span class="mi">1311</span><span class="s2">             return True</span>
<span class="g g-Whitespace">   </span><span class="mi">1312</span><span class="s2">         except NotFittedError:</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/utils/validation.py</span> in <span class="ni">check_is_fitted</span><span class="nt">(estimator, attributes, msg, all_or_any)</span>
<span class="g g-Whitespace">   </span><span class="mi">1749</span><span class="s2">         raise TypeError(&quot;</span><span class="si">%s</span><span class="s2"> is not an estimator instance.&quot; % (estimator))</span>
<span class="g g-Whitespace">   </span><span class="mi">1750</span><span class="s2"> </span>
<span class="ne">-&gt; </span><span class="mi">1751</span><span class="s2">     tags = get_tags(estimator)</span>
<span class="g g-Whitespace">   </span><span class="mi">1752</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1753</span><span class="s2">     if not tags.requires_fit and attributes is None:</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/utils/_tags.py</span> in <span class="ni">get_tags</span><span class="nt">(estimator)</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span><span class="s2">         for klass in reversed(type(estimator).mro()):</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span><span class="s2">             if &quot;__sklearn_tags__&quot; in vars(klass):</span>
<span class="ne">--&gt; </span><span class="mi">405</span><span class="s2">                 sklearn_tags_provider[klass] = klass.__sklearn_tags__(estimator)  # type: ignore[attr-defined]</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span><span class="s2">                 class_order.append(klass)</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span><span class="s2">             elif &quot;_more_tags&quot; in vars(klass):</span>

<span class="nn">/usr/local/lib/python3.10/dist-packages/sklearn/base.py</span> in <span class="ni">__sklearn_tags__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">538</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">539</span><span class="s2">     def __sklearn_tags__(self):</span>
<span class="ne">--&gt; </span><span class="mi">540</span><span class="s2">         tags = super().__sklearn_tags__()</span>
<span class="g g-Whitespace">    </span><span class="mi">541</span><span class="s2">         tags.estimator_type = &quot;classifier&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">542</span><span class="s2">         tags.classifier_tags = ClassifierTags()</span>

<span class="ne">AttributeError</span>: &#39;super&#39; object has no attribute &#39;__sklearn_tags__&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="experiment-3-feature-engineering-and-attribute-combination">
<h1>Experiment 3: Feature Engineering and Attribute Combination<a class="headerlink" href="#experiment-3-feature-engineering-and-attribute-combination" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># experiment-3</span>
<span class="c1"># Aggregate features</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;credit_card_fraud_data.csv&quot;</span><span class="p">)</span>

<span class="c1"># Ensuring datetime column is in proper format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>

<span class="c1"># Feature Engineering</span>
<span class="c1"># Extract time-based features</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DAY_OF_WEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>

<span class="c1"># Aggregate features</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;CUSTOMER_ID_NB_TX_RATIO_7_30DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;CUSTOMER_ID_NB_TX_7DAY_WINDOW&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;CUSTOMER_ID_NB_TX_30DAY_WINDOW&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-6</span>
<span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_ID_NB_TX_RATIO_1_7DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_ID_NB_TX_1DAY_WINDOW&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_ID_NB_TX_7DAY_WINDOW&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-6</span>
<span class="p">)</span>

<span class="c1"># Risk-based features</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_ID_RISK_RATIO_1_30DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_ID_RISK_1DAY_WINDOW&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_ID_RISK_30DAY_WINDOW&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-6</span>
<span class="p">)</span>

<span class="c1"># Log transformations</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;LOG_TX_AMOUNT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_AMOUNT&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;LOG_TERMINAL_RISK_30DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TERMINAL_ID_RISK_30DAY_WINDOW&#39;</span><span class="p">])</span>

<span class="c1"># Drop unused or redundant columns</span>
<span class="n">unused_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">,</span> <span class="s1">&#39;TX_AMOUNT&#39;</span><span class="p">]</span>  <span class="c1"># Keep relevant engineered features</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">unused_cols</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Split features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">])</span>  <span class="c1"># Target column</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">]</span>

<span class="c1"># Preprocessing</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Model and pipeline</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Hyperparameter tuning</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
    <span class="s1">&#39;classifier__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Log results to MLflow</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Train and tune the model</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>

    <span class="c1"># Compute metrics</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># Log parameters and metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_positive&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;true_negative&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_positive&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;false_negative&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

    <span class="c1"># Log the model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;feature_engineering_pipeline&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature Engineering and Experiment logged successfully!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/21 19:16:02 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Feature Engineering and Experiment logged successfully!
🏃 View run indecisive-fowl-745 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1/runs/93531e6b110042989d901a38300a4913
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/1
</pre></div>
</div>
</div>
</div>
</section>
<section id="experiment-4-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold">
<h1>Experiment 4: Feature Selection using Correlation Threshold, Feature Importance, and Variance Threshold<a class="headerlink" href="#experiment-4-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># experiment 4</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment-4&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;credit_card_fraud_data.csv&quot;</span><span class="p">)</span>

<span class="c1"># Feature engineering</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DAYOFWEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>  <span class="c1"># Day of the week</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>  <span class="c1"># Hour of the day</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_MONTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>  <span class="c1"># Month</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_YEAR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>  <span class="c1"># Year</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>  <span class="c1"># Day of the month</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_TIME_DIFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>  <span class="c1"># Time difference</span>

<span class="c1"># Features and target variable</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">,</span> <span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>  <span class="c1"># Drop target and date columns</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">]</span>

<span class="c1"># Step 1: Correlation Threshold</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Set a correlation threshold to remove highly correlated features</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">corr_to_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Set to hold correlated features to drop</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">colname</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">corr_to_drop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span>

<span class="n">X_corr_filtered</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">corr_to_drop</span><span class="p">)</span>

<span class="c1"># Step 2: Feature Importance using RandomForestClassifier</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_corr_filtered</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Get feature importances</span>
<span class="n">feature_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span>
                                   <span class="n">index</span><span class="o">=</span><span class="n">X_corr_filtered</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;importance&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Select the top N features (top 10)</span>
<span class="n">top_features</span> <span class="o">=</span> <span class="n">feature_importances</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Filter the data to keep only the most important features</span>
<span class="n">X_important_features</span> <span class="o">=</span> <span class="n">X_corr_filtered</span><span class="p">[</span><span class="n">top_features</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_important_features</span><span class="p">)</span>

<span class="c1"># Step 3: Variance Threshold</span>
<span class="c1"># Remove features with low variance</span>
<span class="n">variance_threshold</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># e.g., 1% variance</span>
<span class="n">X_variance_filtered</span> <span class="o">=</span> <span class="n">variance_threshold</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_important_features</span><span class="p">)</span>

<span class="c1"># Convert back to a DataFrame for logging</span>
<span class="n">X_variance_filtered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_variance_filtered</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_important_features</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">variance_threshold</span><span class="o">.</span><span class="n">get_support</span><span class="p">()])</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log Correlation Threshold results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;correlation_threshold&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;features_dropped_by_correlation&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">corr_to_drop</span><span class="p">))</span>

    <span class="c1"># Log Feature Importance results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;top_important_features&quot;</span><span class="p">,</span> <span class="n">top_features</span><span class="p">)</span>

    <span class="c1"># Log Variance Threshold results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;variance_threshold&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;features_dropped_by_variance&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X_important_features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">X_variance_filtered</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

    <span class="c1"># Evaluate model using the selected features</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">f1_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X_variance_filtered</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_variance_filtered</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">X_variance_filtered</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">f1_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="c1"># Log F1 scores</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_f1_score&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">f1_scores</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_f1_score&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">f1_scores</span><span class="p">))</span>

    <span class="c1"># Log confusion matrix metrics</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_variance_filtered</span><span class="p">)</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>

    <span class="c1"># Log the model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;RandomForest_model_after_feature_selection&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aba6132f468721065cd26566c1d53b730b9c89eba8a22ac9876538bfebd62741.png" src="_images/aba6132f468721065cd26566c1d53b730b9c89eba8a22ac9876538bfebd62741.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;TRANSACTION_ID&#39;, &#39;CUSTOMER_ID&#39;, &#39;TERMINAL_ID&#39;, &#39;TX_AMOUNT&#39;,
       &#39;TX_FRAUD_SCENARIO&#39;, &#39;TX_DURING_WEEKEND&#39;, &#39;TX_DURING_NIGHT&#39;,
       &#39;CUSTOMER_ID_NB_TX_1DAY_WINDOW&#39;, &#39;CUSTOMER_ID_AVG_AMOUNT_1DAY_WINDOW&#39;,
       &#39;CUSTOMER_ID_NB_TX_7DAY_WINDOW&#39;, &#39;CUSTOMER_ID_AVG_AMOUNT_7DAY_WINDOW&#39;,
       &#39;CUSTOMER_ID_NB_TX_30DAY_WINDOW&#39;, &#39;TERMINAL_ID_NB_TX_1DAY_WINDOW&#39;,
       &#39;TERMINAL_ID_RISK_1DAY_WINDOW&#39;, &#39;TERMINAL_ID_NB_TX_7DAY_WINDOW&#39;,
       &#39;TERMINAL_ID_RISK_7DAY_WINDOW&#39;, &#39;TERMINAL_ID_NB_TX_30DAY_WINDOW&#39;,
       &#39;TERMINAL_ID_RISK_30DAY_WINDOW&#39;, &#39;TX_DAYOFWEEK&#39;, &#39;TX_HOUR&#39;, &#39;TX_YEAR&#39;,
       &#39;TX_DAY&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="experiment-5-pca-for-dimensionality-reduction">
<h1>Experiment 5: PCA for Dimensionality Reduction<a class="headerlink" href="#experiment-5-pca-for-dimensionality-reduction" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># experiment 5</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment-5&quot;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;credit_card_fraud_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Convert TX_DATETIME to datetime format</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>

<span class="c1"># Extract datetime features</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DAYOFWEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>  <span class="c1"># Day of the week</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>  <span class="c1"># Hour of the day</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_MONTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>  <span class="c1"># Month</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_YEAR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>  <span class="c1"># Year</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>  <span class="c1"># Day of the month</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_TIME_DIFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

<span class="c1"># Drop TX_DATETIME as it&#39;s no longer needed</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>

<span class="c1"># Define features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">])</span>  <span class="c1"># Drop target column from features</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">]</span>  <span class="c1"># Target variable</span>

<span class="c1"># Drop any non-numeric columns in X</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>

<span class="c1"># Step 1: Perform Feature Selection Using Random Forest</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Get feature importances</span>
<span class="n">feature_importances</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span>

<span class="c1"># Create a dataframe to display feature importance</span>
<span class="n">importance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Feature&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;Importance&#39;</span><span class="p">:</span> <span class="n">feature_importances</span><span class="p">})</span>
<span class="n">importance_df</span> <span class="o">=</span> <span class="n">importance_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Select features with importance above a threshold</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">selected_features</span> <span class="o">=</span> <span class="n">importance_df</span><span class="p">[</span><span class="n">importance_df</span><span class="p">[</span><span class="s1">&#39;Importance&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">][</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected Features (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">selected_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Filter dataset with selected features</span>
<span class="n">X_selected</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">selected_features</span><span class="p">]</span>

<span class="c1"># Step 2: Standardize the features</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_selected</span><span class="p">)</span>

<span class="c1"># Step 3: Apply PCA</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="c1"># Scree plot (explained variance ratio)</span>
<span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
<span class="n">cumulative_variance_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">cumulative_variance_ratio</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cumulative Explained Variance&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance_ratio</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">explained_variance_ratio</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Explained Variance per Component&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained Variance Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot for PCA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;scree_plot.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Step 4: Choose the number of components</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_variance_ratio</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of components explaining 95% variance: </span><span class="si">{</span><span class="n">n_components</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Apply PCA with selected components</span>
<span class="n">pca_selected</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
<span class="n">X_pca_selected</span> <span class="o">=</span> <span class="n">pca_selected</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;n_selected_features&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;n_components&quot;</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;total_explained_variance&quot;</span><span class="p">,</span> <span class="n">cumulative_variance_ratio</span><span class="p">[</span><span class="n">n_components</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;scree_plot.png&quot;</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;plots&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pca_selected</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;models/pca_model&quot;</span><span class="p">)</span>

    <span class="n">importance_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;feature_importances.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;feature_importances.csv&quot;</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;artifacts&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PCA results and scree plot logged to MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected Features (6): [&#39;TX_FRAUD_SCENARIO&#39;, &#39;TX_AMOUNT&#39;, &#39;TERMINAL_ID_RISK_7DAY_WINDOW&#39;, &#39;TERMINAL_ID_RISK_30DAY_WINDOW&#39;, &#39;TERMINAL_ID_RISK_1DAY_WINDOW&#39;, &#39;CUSTOMER_ID_AVG_AMOUNT_1DAY_WINDOW&#39;]
</pre></div>
</div>
<img alt="_images/7f27eeeb2e634f122f75c4b88c8b5eea32a973264adfcca4183c1d8d34ced1b3.png" src="_images/7f27eeeb2e634f122f75c4b88c8b5eea32a973264adfcca4183c1d8d34ced1b3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of components explaining 95% variance: 5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 20:22:13 WARNING mlflow.sklearn: Model was missing function: predict. Not logging python_function flavor!
<span class=" -Color -Color-Red">2024/12/20 20:22:17 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PCA results and scree plot logged to MLflow.
🏃 View run exultant-wren-168 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/4/runs/67810e65790c4b33bd11c451936a6846
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/4
</pre></div>
</div>
</div>
</div>
</section>
<section id="experiment-6-trainind-svm-model-with-preprocessing-evaluation-and-mlflow-logging">
<h1>Experiment 6: Trainind SVM Model with Preprocessing, Evaluation, and MLflow Logging<a class="headerlink" href="#experiment-6-trainind-svm-model-with-preprocessing-evaluation-and-mlflow-logging" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># experiment 6</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment-6&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;credit_card_fraud_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Preprocess the dataset</span>
<span class="c1"># Convert TX_DATETIME to datetime</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>  <span class="c1"># Drop rows where conversion failed</span>

<span class="c1"># Extract datetime features</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DAYOFWEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_MONTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_YEAR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_TIME_DIFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

<span class="c1"># Drop unnecessary columns</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">,</span> <span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">]</span>

<span class="c1"># Standardize the features</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Split the data into train and test sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Train an SVM model</span>
<span class="n">svm_model</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log model parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;kernel&quot;</span><span class="p">,</span> <span class="s2">&quot;rbf&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">)</span>

    <span class="c1"># Train the model</span>
    <span class="n">svm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Make predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">svm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Evaluate the model</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">conf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>

    <span class="c1"># Save and log confusion matrix plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Not Fraud&#39;</span><span class="p">,</span> <span class="s1">&#39;Fraud&#39;</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Not Fraud&#39;</span><span class="p">,</span> <span class="s1">&#39;Fraud&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plot_path</span> <span class="o">=</span> <span class="s2">&quot;confusion_matrix.png&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">plot_path</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;plots&quot;</span><span class="p">)</span>

    <span class="c1"># Log the trained model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">svm_model</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;models/svm_model&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score logged: </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7c4c9732c36625470e2160d3604ea565c90c813b938e41b0f259bb2eec0dd6ce.png" src="_images/7c4c9732c36625470e2160d3604ea565c90c813b938e41b0f259bb2eec0dd6ce.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/20 20:07:10 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F1 Score logged: 0.9997728821258233
🏃 View run adorable-jay-36 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/5/runs/0092a977bc87411baa5967963eda7099
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/5
</pre></div>
</div>
</div>
</div>
</section>
<section id="experiment-7-training-a-naive-bayes-model-with-evaluation-visualization-and-mlflow-logging">
<h1>Experiment 7: Training a Naive Bayes Model with Evaluation, Visualization, and MLflow Logging<a class="headerlink" href="#experiment-7-training-a-naive-bayes-model-with-evaluation-visualization-and-mlflow-logging" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#experiment 7</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment-7&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Preprocess the dataset</span>
<span class="c1"># Convert TX_DATETIME to datetime</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;credit_card_fraud_data.csv&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>  <span class="c1"># Drop rows where conversion failed</span>

<span class="c1"># Extract datetime features</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DAYOFWEEK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_MONTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_YEAR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_TIME_DIFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

<span class="c1"># Drop unnecessary columns</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">,</span> <span class="s1">&#39;TX_DATETIME&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TX_FRAUD&#39;</span><span class="p">]</span>

<span class="c1"># Step 2: Initialize and train the Naive Bayes model</span>
<span class="n">nb_model</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">nested</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># Train the model</span>
    <span class="n">nb_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Predict on the test set</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">nb_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Calculate F1 score</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">)</span>

    <span class="c1"># Generate confusion matrix</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Log F1 score</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>

    <span class="c1"># Log model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">nb_model</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;models/naive_bayes&quot;</span><span class="p">)</span>

    <span class="c1"># Log confusion matrix as a plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Non-Fraud&quot;</span><span class="p">,</span> <span class="s2">&quot;Fraud&quot;</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Non-Fraud&quot;</span><span class="p">,</span> <span class="s2">&quot;Fraud&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;plots&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Log classification report</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Precision&quot;</span><span class="p">,</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">][</span><span class="s2">&quot;precision&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Recall&quot;</span><span class="p">,</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">][</span><span class="s2">&quot;recall&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1-Score for Class 1&quot;</span><span class="p">,</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">][</span><span class="s2">&quot;f1-score&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">,</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>

<span class="c1"># Print F1 score and confusion matrix for verification</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Red">2024/12/21 21:12:05 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run enthused-asp-719 at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/6/runs/dfb1ad5231f34d0e84debfdaca84c7cb
🧪 View experiment at: https://dagshub.com/Bhavyak10/my-first-repo.mlflow/#/experiments/6
F1 Score: 0.04440497335701599
Confusion Matrix:
[[521843      0]
 [  4304    100]]
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="demovideo.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Demo video</p>
      </div>
    </a>
    <a class="right-next"
       href="linktoprojects.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Links to Project:</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">ML experiments</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-1-create-normalized-3nf-tables-customers-terminals-transactions">Task 1: Create normalized 3NF tables: Customers, Terminals, Transactions</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-2-fetch-data-from-the-database-and-load-into-pandas-dataframe-using-join-statement">#Task 2: Fetch data from the database and load into Pandas DataFrame using join statement</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-3-stratified-train-test-split">Task-3 Stratified train-test split</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#task-4-eda-using-yprofile-and-correlation-matrix">Task-4 EDA using yprofile and correlation matrix</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-1-preprocessing-pipeline-with-logistic-regression-and-mlflow-logging">Experiment 1: Preprocessing Pipeline with Logistic Regression and MLflow Logging</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-2-preprocessing-pipeline-with-multiple-classifiers-and-mlflow-logging">Experiment 2: Preprocessing Pipeline with Multiple Classifiers and MLflow Logging</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-3-feature-engineering-and-attribute-combination">Experiment 3: Feature Engineering and Attribute Combination</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-4-feature-selection-using-correlation-threshold-feature-importance-and-variance-threshold">Experiment 4: Feature Selection using Correlation Threshold, Feature Importance, and Variance Threshold</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-5-pca-for-dimensionality-reduction">Experiment 5: PCA for Dimensionality Reduction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-6-trainind-svm-model-with-preprocessing-evaluation-and-mlflow-logging">Experiment 6: Trainind SVM Model with Preprocessing, Evaluation, and MLflow Logging</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-7-training-a-naive-bayes-model-with-evaluation-visualization-and-mlflow-logging">Experiment 7: Training a Naive Bayes Model with Evaluation, Visualization, and MLflow Logging</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bhavya khilrani
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>